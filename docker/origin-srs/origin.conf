# SRS Origin Server Configuration
# Simple passthrough - no transcoding, no HLS
# FFmpeg container handles HLS ABR generation with perfect GOP alignment

listen              1935;
max_connections     300;
server_id           71;

srs_log_tank        console;
daemon              off;

# HTTP API for stream monitoring
http_api {
    enabled         on;
    listen          1985;
}

# HTTP server for stats/debugging (not for HLS)
http_server {
    enabled         on;
    listen          8082;
    dir             ./objs/nginx/html;
}

# Disable RTC
rtc_server {
    enabled         off;
}

# Main vhost - simple passthrough
vhost __defaultVhost__ {
    # Webhook authentication for publishing
    http_hooks {
        enabled         on;
        on_publish      http://127.0.0.1/api/srs/auth;
        on_unpublish    http://127.0.0.1/api/srs/unpublish;
    }

    dvr {
        enabled             on;
        dvr_path            ./objs/nginx/html/[app]/[stream]/[2006]/[01]/[02]/[15].[04].[05].[999].flv;
        dvr_plan            segment;
        dvr_duration        30;
        dvr_wait_keyframe   on;
    }

    # No HLS - FFmpeg handles this
    hls {
        enabled         off;
    }

    # No transcoding - FFmpeg handles this
    transcode {
        enabled         off;
    }

    # Keep GOP cache for lower latency on playback start
    play {
        gop_cache       on;
        mw_latency      1800;
    }

    # No HTTP remux
    http_remux {
        enabled         off;
    }
}
